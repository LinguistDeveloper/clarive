#!/usr/bin/env perl

use v5.10;
use strict;
use Proc::ProcessTable;

my $FORMAT = "%-6s %-6s %-8s %-24s %s";
my $t = new Proc::ProcessTable;
my @disp;
my @server;
my $top = sprintf($FORMAT, "PID", "PPID", "STAT", "START", "COMMAND");
foreach my $p ( @{$t->table} ){
    my $lin = sprintf($FORMAT,
          $p->pid,
          $p->ppid,
          #$p->ttydev,
          $p->state,
          scalar(localtime($p->start)),
          $p->cmndline);
    given( $p->cmndline ) {
        when( /starman|plackup|bali_server/ ) {
            push @server, $lin;
        }
        when( /perl/ && /ba.*pl/ ) {
            push @disp, $lin;
        }
    }
}

say "--------------| Dispatcher |-----------";
say $top if @disp;
say for @disp;
say "--------------|   Server   |-----------";
say $top if @server;
say for @server;

