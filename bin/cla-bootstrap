#!/bin/bash

BINDIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
CLARIVE_BASE=`realpath "$BINDIR/../../"`

ARGV=( "$@" )
OPT_RESET=0
OPT_DEV=0

index=0
for keyword in ${ARGV[@]}; do
    if [ "$keyword" = "--reset" ]; then
        OPT_RESET=1
        unset ARGV[$index]
    elif [ "$keyword" = "--dev" ]; then
        OPT_DEV=1
        unset ARGV[$index]
    fi
    let index++
done

if [[ "$OPT_RESET" == 1 ]]; then
    echo 'Resetting bootstrap...'

    rm -rf "$CLARIVE_BASE/local";
    rm -rf "$CLARIVE_BASE/stew.snapshot";
    rm -rf "$CLARIVE_BASE/clarive/build";
fi

echo 'Installing dependencies...'

cd $CLARIVE_BASE/clarive

bin/cla stew install . "${ARGV[@]}"

if [[ "$OPT_DEV" == 1 ]]; then
    echo 'Installing development dependencies...'

    bin/cla stew install clarive-dev "${ARGV[@]}"
fi

cd -
