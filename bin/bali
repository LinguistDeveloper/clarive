#!/bin/sh

if [ "$BASELINER_HOME" != "" ]; then
    cd $BASELINER_HOME
else
    BASEDIR=$(dirname $0)/..
    BASEDIR=`perl -MCwd -e 'print Cwd::realpath "$BASEDIR"'`
    export BASELINER_HOME=$BASEDIR
fi

export LIBPATH=$BASELINER_LIBPATH:$LIBPATH

if [ "$BASELINER_ENV" != "" ]; then
    export CATALYST_CONFIG_LOCAL_SUFFIX=$BASELINER_ENV
elif [ "$BALI_ENV" != "" ]; then
    export CATALYST_CONFIG_LOCAL_SUFFIX=$BALI_ENV
fi

if [ "$BASELINER_NLS_LANG" != "" ]; then
    export NLS_LANG=$BASELINER_NLS_LANG
else
    export NLS_LANG=AMERICAN_AMERICA.UTF8
fi

if [ "$BASELINER_SCRIPT" == "" ]; then
    export BASELINER_SCRIPT=script/bali.pl
fi

if [ "$BASELINER_TRACE" != "" ]; then
    BASELINER_TRACE_MODULE="-d:Trace::More" 
fi

if [ "$BASELINER_LANG" != "" ]; then
    export LANG=$BASELINER_LANG
else
    export LANG=en_US.UTF-8
fi
# check if its a porcelain command
if [ -f "script/bali_$1.pl" ]; then
    export BASELINER_SCRIPT=script/bali_$1.pl
    shift
fi

# -X : no warnings for production environments
exec perl $BASELINER_TRACE_MODULE -I$BASELINER_HOME/lib -X $BASELINER_SCRIPT "$@"

