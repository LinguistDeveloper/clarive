//////////////// Edit Config Value Create / Edit Window

var edit_config = function(rec) {

        var config_name = '';
        var xtype = 'textarea';
        var input_type = 'text';
        if (rec != undefined) {
            config_name = rec.get('config_name') == null ? '' : rec.get('config_name') + ": ";
            config_name += rec.get('config_label') == null ? rec.get('key') : rec.get('config_label');
            if (rec.get('config_type') == 'password') {
                input_type = 'password';
                xtype = 'textfield';
            }
        }

    var form = new Ext.form.FormPanel({
    baseCls: 'x-plain',
    labelWidth: 100,
    url: '/configlist/update',
    itemCls: 'config_form_body_items',
    defaults: {
    xtype: 'textfield'
    },
    items: [{
            fieldLabel: '<% _loc('Key ') %>',
            name: 'key',
            allowBlank: false
        }, {
            fieldLabel: '<% _loc('Scope ') %>',
            name: 'ns',
            value: '/'
        }, {
            fieldLabel: '<% _loc('Baseline ') %>',
            name: 'bl',
            value: '*'
        }, {
            fieldLabel: '<% _loc('Default Value ') %>',
            name: 'config_default',
            value: '*',
            readOnly: true
        }, {
            xtype: xtype,
            fieldLabel: '<% _loc('Value ') %>',
            hideLabel: input_type == 'password' ? false : true,
            name: 'value',
            anchor: input_type == 'password' ? '' : '99% -98',
            inputType: input_type
        }
    ]
});

    var baselines = new Ext.data.SimpleStore({ 
       fields: ['bl', 'name'], 
       data : <% js_dumper( $c->stash->{baselines} ) %>
    }); 

    var win = new Ext.Window({
        layout: 'fit',
        plain: true,
        bodyStyle:'padding:5px;',
        height: 400,
        width: 650,
        maximizable: true,
        closeAction: 'close',
        autoDestroy: true,
        title: rec==undefined ? '<% _loc("New Config Key") %>' : config_name,
        items : [
              form
          ],
        buttons: [{
            text: '<% _loc('Save') %>', 
            icon: '/static/images/icons/save.png', 
            handler: function() {
                var ff = form.getForm();
                ff.submit({
                        success: function(form, action) { 
                            grid.getStore().load();
                            win.close(); 
                        },
                        failure: function(form, action) { Ext.Msg.alert("<% _loc('Failure') %>", action.result.msg); }
                });
            }
        },{
            text: '<% _loc('Reset') %>',
            icon: '', 
            handler: function() {
                if( rec!=undefined ) {
                    form.getForm().loadRecord(rec);
                }
            }
        },{
            text: '<% _loc('Close') %>',
            icon: '/static/images/icons/close.svg', 
            handler: function() {
                win.close();
            }
        }]
    });

    //////// Show the Window
    win.show();

    //////// Load form and grid data
    if( rec!=undefined ) {
        // Form
        var ff = form.getForm();
        ff.loadRecord( rec );
    }

}


