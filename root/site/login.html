<head>
	<& '/site/nocache.html' &>
	<& '/site/top.html' &>
</head>
<style type="text/css" media="screen">
	body {
	 height: 100%;
	 padding: 0;
	 margin: 0;
	 font-family: Verdana, Arial, Helvetica, sans-serif;
	} 
	.band-white {
		 background-color: #FFFFFF;
		 position: absolute;
		 top: 50px;
		 width: 100%;
		 height: 170px;
	} 
	.band-gray {
		 background-color: #DDD6DD;
		 position: absolute;
		 top: 0px;
		 width: 100%;
		 height: 100%;
	} 
	.logo {
		 position: absolute;
		 top: 70px;
		 left: 35%;
		 padding: 5px;
	} 
	.centered {
		 position: absolute;
		 top: 140;
		 left: 35%;
		 width: 30%;
		 background-color: #CCCCCC;
		 padding: 5px;
	} 
</style>

<script type="text/javascript">
Ext.onReady(function(){
	Ext.BLANK_IMAGE_URL = '/static/ext/resources/images/default/s.gif';
	Ext.QuickTips.init();

	var after_login = "<% $c->stash->{after_login} %>";
	Ext.Ajax.timeout = 60000;

    Baseliner.doLoginForm = function(){
                                var ff = login_form.getForm();
                                ff.submit({
                                    success: function(form, action) {
                                                    var last_login = form.findField('login').getValue();
                                                    Baseliner.cookie.set( 'last_login', last_login ); 
                                                    document.location.href = after_login || '/';
                                             },
                                    failure: function(form, action) {
                                                    Ext.Msg.alert('<% _loc('Login Failed') %>', action.result.msg );
													login_form.getForm().findField('login').focus('',100);
                                                    //login_form.getForm().findField('password').getValue() == ''
													//	? login_form.getForm().findField('login').focus('',100)
                                                    //	: login_form.getForm().findField('password').focus('',100);
                                              }
                                });
                           };

    var login_form = new Ext.FormPanel({
            url: '/login',
			id: 'lf',
            frame: true,
            labelWidth: 60, 
			renderTo: document.body,
			bodyStyle:'padding:5px 5px 0',
			cls: 'centered',
            defaults: { width: 150 },
            buttons: [
                { text: '<% _loc('Login') %>',
                  handler: Baseliner.doLoginForm
                },
                { text: '<% _loc('Reset') %>',
                  handler: function() {
                                login_form.getForm().findField('login').focus('',100);
                                login_form.getForm().reset()
                           }
                }
            ],
            items: [
                {  xtype: 'textfield', name: 'login', width: "100%", fieldLabel: "<% _loc('Username') %>", selectOnFocus: true }, 
                {  xtype: 'textfield', name: 'password', width: "100%", inputType:'password', fieldLabel: "<% _loc('Password') %>", selectOnFocus: true} 
            ]
        });

	 var map = new Ext.KeyMap(document, [{
            key : [10, 13],
            fn : Baseliner.doLoginForm
        }]); 

     var last_login = Baseliner.cookie.get( 'last_login'); 

     if( last_login!=undefined && last_login.length > 0 )  {
            login_form.getForm().findField('login').setValue( last_login );
            login_form.getForm().findField('password').focus('',100);
     } else {
            login_form.getForm().findField('login').focus('',100);
     }
});
</script>
<body>
<div class="band-gray"></div>
<div class="band-white"></div>
<img class="logo" src="<% $c->config->{login_logo} || '/static/images/logo_big.jpg' %>"></img>
</body>
