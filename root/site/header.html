
<!DOCTYPE html>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta http-equiv="X-UA-Compatible" content="IE=7,8,9" />
<%perl>
    my $lang = $c->language;
    my $to_bool = sub{ 
        ref $_[0] and return $_[0]; $_[0] eq '1' ? \1 : $_[0] eq '0' ? \0 : $_[0] 
    };
    
</%perl>
<html>
 <head>
    <& '/site/nocache.html' &>
    <& '/site/top.html' &>
    <script type="text/javascript" src="/site/tablegrid.js"></script>
    <script type="text/javascript" src="/site/tabfu.js"></script>
    <script type="text/javascript" src="/site/help.js"></script>
    <script type="text/javascript" src="/site/runner.js"></script>
    <script type="text/javascript" src="/site/panelresizer.js"></script>
     <script type="text/javascript" src="/site/dnd_tabpanel.js"></script>
    <script type="text/javascript" src="/static/momentjs/moment-with-locales.min.js"></script>
    <!-- script type="text/javascript" src="/static/livegrid/livegrid-all.js"></script -->
    <!-- script type="text/javascript" src="/static/pdfjs/pdf.min.js"></script -->

    <script>if( !Ext.isIE ) { $('#bali-loading .progress .bar').width('40%');}</script>

    <!-- DatePickerPlus - Ext -->
    <script type="text/javascript" src="/static/datepickerplus/ext.ux.datepickerplus-min.js"></script> 
% if( length $lang && $lang =~ /en|es/ ) {
    <script type="text/javascript" src="/static/datepickerplus/ext.ux.datepickerplus-lang-<% $lang %>.js"></script> 
% }
    <link rel="stylesheet" href="/static/datepickerplus/datepickerplus.css" type="text/css" />

    <!-- Datatables (on demand require later) -->
    <link rel="stylesheet" href="/static/datatables/css/jquery.dataTables.min.css" type="text/css" />
    <link rel="stylesheet" href="/static/datatables/css/dataTables.bootstrap.css" type="text/css" />

    <!-- Flot -->
    <script src="/static/flot/excanvas.min.js"></script>
    <script src="/static/flot/jquery.flot.js"></script>
    <script src="/static/flot/jquery.flot.pie.js"></script>
    <script src="/static/flot/jquery.flot.orderBars.js"></script>
    <!-- errors with latest jquery script src="/static/flot/jquery.flot.resize.js"></script -->
    <script src="/static/flot/flot.js"></script>

    <script src="/static/jquery/jquery.injectCSS.js"></script>

    <!-- The JIT -->
    <script src="/static/jit/jit.js"></script>

    <!-- JSGantt -->
    <!--
    <link rel="stylesheet" type="text/css" href="/static/jsgantt.css" />
    <script language="javascript" src="/static/jsgantt.js"></script>
    -->

    <!-- Pagedown -->
    <link rel="stylesheet" href="/static/pagedown/pagedown.css">
    <script type="text/javascript" src="/static/pagedown/Markdown.Converter.js"></script>
    <script type="text/javascript" src="/static/pagedown/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="/static/pagedown/Markdown.Editor.js"></script>
    
    <!-- CLEditor -->
    <link rel="stylesheet" href="/static/cleditor/jquery.cleditor.css">
    <script type="text/javascript" src="/static/cleditor/jquery.cleditor.min.js"></script>
    
    <!-- Ace -->
    <script type="text/javascript" src="/static/ace/ace.js"></script>

    <!-- Timeline Similes -->
    <link rel="stylesheet" href="/static/timeline/jquery.timeline.css">
    
    <!-- link rel="stylesheet" href="/static/timeline/clarive-timeline.css" / -->
    
    <!-- objectDiff -->
    <script src="/static/objectDiff/objectDiff.js"></script>

    <!-- js-yaml -->
    <script src="/static/js-yaml/js-yaml.js"></script>

    <!-- CodeMirror -->
    <link rel="stylesheet" href="/static/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="/static/codemirror/theme/elegant.css">
    <link rel="stylesheet" href="/static/codemirror/theme/night.css">
    <link rel="stylesheet" href="/static/codemirror/theme/eclipse.css">
    <link rel="stylesheet" href="/static/codemirror/theme/lesser-dark.css">
    <link rel="stylesheet" href="/static/codemirror/lib/util/simple-hint.css">
    <script type="text/javascript" src="/static/codemirror/lib/codemirror.js"></script>
    <script type="text/javascript" src="/static/codemirror/lib/util/formatting.js"></script>
    <script type="text/javascript" src="/static/codemirror/lib/util/simple-hint.js"></script>
    <script type="text/javascript" src="/static/codemirror/mode/perl/perl.js"></script>
    <script type="text/javascript" src="/static/codemirror/mode/javascript/javascript.js"></script>
    <script type="text/javascript" src="/static/codemirror/mode/xml/xml.js"></script>
    <script type="text/javascript" src="/static/codemirror/mode/plsql/plsql.js"></script>
    <script type="text/javascript" src="/static/codemirror/mode/css/css.js"></script>
    <script type="text/javascript" src="/static/codemirror/mode/markdown/markdown.js"></script>
    <style type="text/css">
        .CodeMirror { border: 1px solid #eee;} 
        .CodeMirror-scroll {
            overflow: visible;
            height: 100%;
        }
        .CodeMirror-fullscreen {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            margin: 0;
            padding: 0;
            border: 0px solid #BBBBBB;
            opacity: 1;
        }
    </style>

    <!-- Editors: Ace, CLEditor, etc. -->
    <script type="text/javascript" src="/site/editors.js"></script>
    
    <!-- Graph libraries, Jit -->
    <script type="text/javascript" src="/site/graph.js"></script>

    <script>if( !Ext.isIE ) { $('#bali-loading .progress .bar').width('60%'); }</script>
    
    <!--  -->
    <script type="text/javascript" src="/site/explorer.js"></script>

    <!-- Portal Stuff -->
    <script type="text/javascript" src="/site/portal/Portal.js"></script>
    <script type="text/javascript" src="/site/portal/PortalColumn.js"></script>
    <script type="text/javascript" src="/site/portal/Portlet.js"></script>
    <script type="text/javascript" src="/site/portal/PortalUtil.js"></script>
    <link rel="stylesheet" type="text/css" href="/site/portal/portal.css" />
    <link rel="stylesheet" type="text/css" href="/site/portal/sample.css" />
    <link rel="stylesheet" type="text/css" href="/site/portal/examples.css" />
    
    <link rel="stylesheet" type="text/css" href="/static/livegrid/resources/css/ext-ux-livegrid.css" /> 

    <!-- uploader drag-drop -->
    <script type="text/javascript" src="/static/valums/fileuploader.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/valums/fileuploader.css" />
    <!-- superbox -->
    <script type="text/javascript" src="/static/superbox/superbox.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/superbox/superbox.css" /> 

    <!-- model depends on superbox -->
    <script type="text/javascript" src="/static/latinise.js"></script>
    <script type="text/javascript" src="/site/model.js"></script>
    <script type="text/javascript" src="/site/kanban.js"></script>
    <script type="text/javascript" src="/site/dashboard.js"></script>
    <script type="text/javascript" src="/comp/topic/topic_lib.js"></script>
    <script type="text/javascript" src="/comp/topic/topic_lib_grid.js"></script>

    <!-- Cal -->
    <link rel="stylesheet" type="text/css" href="/static/fullcalendar/fullcalendar.css" />
    <link rel="stylesheet" type="text/css" href="/static/fullcalendar/fullcalendar.print.css" media="print" />
    <script type="text/javascript" src="/static/fullcalendar/fullcalendar.min.js"></script>

    <!-- Treegrid -->
    <link rel="stylesheet" type="text/css" href="/static/gridtree/css/treegrid.css" />
    <script type="text/javascript" src="/static/gridtree/treegrid.js"></script>
    
    <!-- final css override -->
    <link rel="stylesheet" type="text/css" href="/static/final.css" />
    <link rel="stylesheet" type="text/css" href="/static/sprites.css" />
    
    <script>if( !Ext.isIE ) { $('#bali-loading .progress .bar').width('80%');}</script>
    
    <!-- Hooks -->
% for my $include ( _array $c->stash->{header_include} ) {
    <!-- BEGIN <% $include->{name} %> -->
<% $include->{content} %> 
    <!-- END   <% $include->{name} %> -->
% }
    <!-- Hooks End -->

    <!-- Ext Spinner Widget -->
    <link rel="stylesheet" href="/static/ex.ux.form.spinner/Spinner.css" type="text/css" /> 
    <script type="text/javascript" src="/static/ex.ux.form.spinner/Spinner.js"></script> 
    <script type="text/javascript" src="/static/ex.ux.form.spinner/SpinnerStrategy.js"></script> 

    <script type="text/javascript" src="/site/prefs.js"></script>
    
    <script type="text/javascript">
        // create global Prefs object
        Prefs = new Baseliner.Prefs({
            username: '<% $c->username %>',
            language: '<% [ _array( $c->languages ) ]->[0] %>',
            logo_file: '<% $c->config->{logo_file} %>',
            logo_filename: '<% $c->config->{logo_filename} || "logo.jpg" %>',
            site: <% _to_json({ map { $_ => $to_bool->( $c->config->{site}->{$_} ) } keys %{ $c->config->{site} || {} } }) %>,
            toolbar_height: <% $c->config->{toolbar_height} // 28 %>,
            menus: [ <% join ',', _array $c->stash->{menus} %> ],
            stash: <% _to_json({
                        map { $_ => $to_bool->( $c->stash->{$_} ) }
                        qw/site_raw can_menu can_change_password can_lifecycle can_surrogate portlets tab_list alert theme_dir show_js_reload/
                    })
                %>
        });

        if( !Ext.isIE ) { $('#bali-loading .progress .bar').width('98%');}
        require(['moment', '/site/main.js'], function(main){
            // after main loaded
            if( Ext.get('bali-loading') )
                Ext.get('bali-loading').remove();

            if( Ext.get('bali-loading-mask') )
                Ext.get('bali-loading-mask').fadeOut({
                    remove:true,
                    callback: function(){
                         var ver = navigator.appVersion.match(/MSIE 7.0/g);
                         if(ver == "MSIE 7.0"){
                                $('.alert-error').fadeIn();
                              // var bw = $('#bali-browser-warn').show();
                              // var bw = $('#bali-browser-warn-mid').show();
                            // $("#bali-browser-version").html('4.5');
                         }                        
                    }
                });
                
            $('#loading-img').show();
            $('#bali-loading .loading-progress').hide();
        });
    </script>

</head>
<body>
<div id="boot">
<div id="boot" class="alert-error" style="display: none; position:absolute; left:0; bottom:0; width:100%; padding:5px; text-align:center;"> <img src="static/images/circular/warning.png" alt="0" /> 
    <span style="color:#000;font-size:1.5em;">
    <% _loc("%1 not supported in <b> mode compatibility </b> (Internet Explorer), Please disable it.", $c->config->{name}) %>
    </span>  
 <img src="static/images/circular/warning.png" alt="0" /> 
</div>
<div id="main-alert" style="top:0; left: 100px; width:80%; position: absolute; z-index: 999999">
</div>
</div>
<iframe id="FD" NAME="FrameDownload" HEIGHT="0px" WIDTH="0%" BORDER="0"></iframe>
<div id='run-panel'></div>
<div id='main-div'></div>

<div id="bali-browser-warn" style="display: none; position:absolute; left:0; top:0; width:100%; height:100%; z-index:20000; background-color:white;"></div>
<div id="bali-browser-warn-mid" style="display: none; position:absolute; left:35%; top:40%; padding:2px; z-index:20001; height:auto;">
  <center>
      <div id="boot" role="dialog">
          <h2><% _loc('Browser Warning') %></h2>
          <p><% _loc("This browser is not supported by %1", $c->config->{name} ) %>
          <div id="bali-browser-ver"></div>
          </p>
      </div>
  </center>
</div>

