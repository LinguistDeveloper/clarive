<!--
name: Topics by category
description: Chart pie (Topics by category)
url: /dashboard/topics_by_category
html: /dashlets/topics_by_category_pie.html
-->
<%perl>
    use Baseliner::Utils;
    my $graph_id = "topics_pie". _nowstamp;
    my @topics_by_category = $c->stash->{topics_by_category};
    my $title = $c->stash->{topics_by_category_title};
</%perl>


<script type="text/javascript">
$(function () {
var data = new Array();
var category_id = new Array();

%foreach my $topic (_array @topics_by_category){
    data.push({ label: "<%$topic->{category}%>", category_id: "<%$topic->{category_id}%>", color:"<%$topic->{color}%>", data: [[1,<%$topic->{total}%>]]});
    category_id["<%$topic->{category}%>"] = <%$topic->{category_id}%>;
%}

	// DEFAULT
    $.plot($("#<%$graph_id%>"), data, 
	{
        series: {
            category_id: category_id,
            pie: {
                show: true,
                radius: 1,
                label: {
                    show: true,
                    radius: 3/4,
                    formatter: function(label, series){
                        return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">'+Math.round(series.percent)+'%</div>';
                    },
                    background: { opacity: 0.5 }
                }
            }
        },
        legend: {
            show: true,
            container: '#<%$graph_id%>legend'

        },
        grid: {
            hoverable: true,
            clickable: true
        }        
	});
	$("#<%$graph_id%>").bind("plothover", pieHover);
	$("#<%$graph_id%>").bind("plotclick", pieClick);    
});

function pieHover(event, pos, obj) 
{
	if (!obj)
                return;
	document.body.style.cursor='pointer';
}

function pieClick(event, pos, obj) 
{
	if (!obj)
                return;
    Baseliner.addNewTabComp('/topic/grid?category_id=' + obj.series.category_id[obj.series.label], _('Topics'));
}

</script>
 

	<style type="text/css">
		div.graph
		{
			width: 250px;
			height: 250px;
			float: left;
			border: 1px dashed gainsboro;
		}
      
    </style>
    
    <h2><%$title%></h2><br>
    <div id="principal" class="grid_10">
        <div id="<%$graph_id%>" class="graph" onmouseout="document.body.style.cursor='default';"></div>
        <div id="<%$graph_id%>legend"  style="float:right;"></div>
    </div>
    
    
    





